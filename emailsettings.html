<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Email Preferences</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />
  <!-- Bootstrap Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />
  <style>
    :root {
      --miami-primary: #00c2d3;   /* teal */
      --miami-secondary: #ff5ea8; /* hot pink */
      --miami-accent: #ff9f43;    /* coral */
      --miami-dark: #22263a;

      /* Override Bootstrap theme colors */
      --bs-primary: var(--miami-primary);
      --bs-primary-rgb: 0, 194, 211;
      --bs-secondary: var(--miami-secondary);
      --bs-secondary-rgb: 255, 94, 168;
    }

    /* Vibrant, Miami-inspired background */
    body.bg-light {
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(0,194,211,.16), transparent 60%),
        radial-gradient(900px 700px at 85% 15%, rgba(255,94,168,.18), transparent 60%),
        radial-gradient(900px 600px at 20% 90%, rgba(255,159,67,.14), transparent 60%),
        linear-gradient(135deg, #fdfcff 0%, #f7ffff 100%);
      min-height: 100vh;
    }

    /* Dark mode background */
    body.bg-light.theme-dark {
      background:
        radial-gradient(1200px 600px at 15% 15%, rgba(0,194,211,.12), transparent 60%),
        radial-gradient(900px 700px at 85% 20%, rgba(255,94,168,.14), transparent 60%),
        radial-gradient(900px 600px at 25% 90%, rgba(255,159,67,.12), transparent 60%),
        linear-gradient(135deg, #0f1320 0%, #141a2a 100%);
      color: #e8f5f7;
    }

    /* Card styling */
    .card.miami {
      border: 0;
      border-radius: 1rem;
      box-shadow: 0 1.25rem 2.25rem rgba(34,38,58,.12);
      overflow: hidden;
      background-color: #ffffff;
    }
    .card.miami .card-header {
      color: #fff;
      background: linear-gradient(135deg, var(--miami-secondary) 0%, var(--miami-primary) 100%);
      border: 0;
    }

    /* Dark mode card */
    .theme-dark .card.miami {
      background-color: #121a2a;
      box-shadow: 0 1.25rem 2.25rem rgba(0,0,0,.35);
    }
    .theme-dark .card-footer {
      background-color: rgba(0,194,211,.1);
    }

    /* Buttons */
    .btn-primary {
      background-image: linear-gradient(135deg, var(--miami-secondary), var(--miami-primary));
      border: none;
    }
    .btn-primary:hover { filter: brightness(.95); }

    .btn-outline-primary {
      color: var(--miami-secondary);
      border-color: var(--miami-secondary);
    }
    .btn-outline-primary:hover {
      color: #fff;
      background-color: var(--miami-secondary);
      border-color: var(--miami-secondary);
    }

    .toolbar-accent .btn {
      box-shadow: 0 .25rem .75rem rgba(255,94,168,.18);
    }

    /* List items and controls */
    .list-group-item {
      transition: background-color .2s ease, transform .2s ease;
      background-color: #fff;
    }
    .list-group-item:hover {
      background-color: rgba(0,194,211,.06);
    }
    .form-check-input:checked {
      background-color: var(--miami-primary);
      border-color: var(--miami-primary);
    }
    .form-check-input:focus {
      box-shadow: 0 0 0 .2rem rgba(0,194,211,.25);
      border-color: var(--miami-primary);
    }

    /* Dark mode list and text adjustments */
    .theme-dark .list-group-item {
      background-color: #0f1522;
      color: #e8f5f7;
      border-color: rgba(255,255,255,.08);
    }
    .theme-dark .list-group-item:hover {
      background-color: rgba(0,194,211,.12);
    }
    .theme-dark .text-body-secondary {
      color: #a8c6ca !important;
    }

    /* Footer accent */
    .card-footer {
      background-color: rgba(0,194,211,.06);
    }
  </style>
</head>
<body class="bg-light">
  <main class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8 col-xl-6">
        <form id="email-preferences" action="https://www.w3schools.com/action_page.php" method="post" novalidate>
          <div class="card miami shadow-lg">
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <h1 class="h5 mb-0">Email Preferences</h1>
                  <small class="text-white-50">Choose which emails you want to receive.</small>
                  <small class="text-white-50 d-block">Only occasional emails. Change anytime.</small>
                </div>
                <div class="form-check form-switch text-white ms-3">
                  <input class="form-check-input" type="checkbox" id="theme-toggle" />
                  <label class="form-check-label" for="theme-toggle">Dark</label>
                </div>
              </div>
            </div>

            <div class="card-body">
              <!-- Master switch replaces Select/Deselect buttons -->
              <div class="d-flex justify-content-end mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="master-toggle" />
                  <label class="form-check-label" for="master-toggle">Select all</label>
                </div>
              </div>

              <!-- Group description for screen readers -->
              <p id="email-pref-help" class="form-text text-body-secondary mb-3">
                Weâ€™ll only email you about critical return alerts, special tax service offers, IRS changes and deadlines, and a monthly newsletter with tax tips.
              </p>

              <fieldset class="m-0 p-0 border-0" aria-describedby="email-pref-help">
                <legend class="visually-hidden">Email Preferences</legend>
                <ul id="pref-list" class="list-group list-group-flush">
                  <li class="list-group-item">
                    <div class="form-check form-check-reverse m-0">
                      <input class="form-check-input" type="checkbox" id="pref-critical" name="critical" />
                      <label class="form-check-label" for="pref-critical">
                        <i class="bi bi-shield-exclamation text-body-secondary me-2" aria-hidden="true"></i>
                        Critical alerts and notifications about your tax return
                      </label>
                    </div>
                  </li>

                  <li class="list-group-item">
                    <div class="form-check form-check-reverse m-0">
                      <input class="form-check-input" type="checkbox" id="pref-offers" name="offers" />
                      <label class="form-check-label" for="pref-offers">
                        <i class="bi bi-tags text-body-secondary me-2" aria-hidden="true"></i>
                        Information about special offers for tax services
                      </label>
                    </div>
                  </li>

                  <li class="list-group-item">
                    <div class="form-check form-check-reverse m-0">
                      <input class="form-check-input" type="checkbox" id="pref-irs" name="irs" />
                      <label class="form-check-label" for="pref-irs">
                        <i class="bi bi-calendar-event text-body-secondary me-2" aria-hidden="true"></i>
                        Receive notifications of IRS changes and deadlines
                      </label>
                    </div>
                  </li>

                  <li class="list-group-item">
                    <div class="form-check form-check-reverse m-0">
                      <input class="form-check-input" type="checkbox" id="pref-newsletter" name="newsletter" />
                      <label class="form-check-label" for="pref-newsletter">
                        <i class="bi bi-newspaper text-body-secondary me-2" aria-hidden="true"></i>
                        Learn from monthly tax newsletter with tax news and tips
                      </label>
                    </div>
                  </li>
                </ul>
              </fieldset>
            </div>

            <div class="card-footer d-flex justify-content-between align-items-center">
              <small id="save-status" class="text-body-secondary" aria-live="polite"></small>
              <button type="submit" class="btn btn-primary">Save Preferences</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    (function () {
      const form = document.getElementById('email-preferences');
      // Only target preference checkboxes (those with a name). Excludes theme & master switches.
      const inputs = Array.from(form.querySelectorAll('input[type="checkbox"][name]'));
      const STATUS = document.getElementById('save-status');
      const STORAGE_KEY = 'emailPreferences';

      // THEME handling
      const THEME_KEY = 'emailPreferencesTheme';
      const body = document.body;
      const themeToggle = document.getElementById('theme-toggle');

      const applyTheme = (mode) => {
        const dark = mode === 'dark';
        body.classList.toggle('theme-dark', dark);
        if (themeToggle) themeToggle.checked = dark;
      };

      const storedTheme = localStorage.getItem(THEME_KEY);
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(storedTheme || (prefersDark ? 'dark' : 'light'));

      themeToggle?.addEventListener('change', (e) => {
        const mode = e.target.checked ? 'dark' : 'light';
        applyTheme(mode);
        localStorage.setItem(THEME_KEY, mode);
      });

      // Load saved checkbox state
      try {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        inputs.forEach(i => {
          if (Object.prototype.hasOwnProperty.call(saved, i.name)) {
            i.checked = !!saved[i.name];
          }
        });
      } catch (_) {
        // ignore parse errors
      }

      // Save state to localStorage and update inline status
      const save = () => {
        const state = inputs.reduce((acc, i) => {
          acc[i.name] = i.checked;
          return acc;
        }, {});
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        if (STATUS) {
          STATUS.textContent = 'Preferences saved locally';
          clearTimeout(save._t);
          save._t = setTimeout(() => (STATUS.textContent = ''), 1500);
        }
      };

      // Master switch logic (single control)
      const masterToggle = document.getElementById('master-toggle');

      const syncMaster = () => {
        const total = inputs.length;
        const checkedCount = inputs.filter(i => i.checked).length;
        if (!masterToggle) return;
        masterToggle.indeterminate = checkedCount > 0 && checkedCount < total;
        masterToggle.checked = checkedCount === total;
      };

      const setAll = (checked) => {
        inputs.forEach(i => i.checked = checked);
        save();
        syncMaster();
      };

      masterToggle?.addEventListener('change', (e) => setAll(e.target.checked));

      // Auto-save on change and keep master in sync
      inputs.forEach(i => i.addEventListener('change', () => { save(); syncMaster(); }));

      // Initial sync
      syncMaster();
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>